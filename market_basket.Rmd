---
title: "CSML1000 Winter 2020, Group 8, Assignment2: Market Basket Prediction Model"
author: "Steven Wang, Tarun Bagga, Paul Doucet, Jerry Khidaroo, Nicola Stevanovic"
date: "2/15/2020"
output: 
  html_document:
  toc: TRUE
  toc_depth: 2
# runtime: shiny
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Load Libraries

```{r, message = FALSE}
# Load packages
library('ggplot2') # visualization
library('ggthemes') # visualization
# library('scales') # visualization
library('dplyr') # data manipulation
library('caret')
library('caret')
library('readr')
library('data.table')
library('knitr')
library('purrr') # ANN modeling functionality
library('arules')
# library('mice') # imputation
# library('randomForest') # classification algorithm
# library('e1071')
# library('shiny')
# library('shinythemes')
# library("nnet")
# library('corrplot')
# library(sqldf)
# library(DT)
# library(stringr)
# library('caTools')
# library(klaR)
```

## 1. Business Understanding

- Business Problem: The Business problem we want to solve is how to increase the number of items ordered by a customer in each order submitted in the online store. To acheive this goal we want to build a machine learning model that predicts the most likely items a customer will add to their basket next based on their current selection and display those items as suggestions for quick access.

- Project Plan: 
  - Load and get an understanding of the dataset, its target variable and its features.
  - Make any modifications to the dataset needed to enable learning algorithms to be run on the data.
  - Identify the features of the dataset that are important in predicting the target variable.
  - Build and evaluate 3 to 4 Models from the dataset by appling various machine learning algoritms as appropiate and testing them.
  - Identify the best model to use for the project.
  - Build a shiny app that deploys the selected model with a user interface for end users to imput measurement values from a study and obtain a pridiction result.
  - Identify any ethical considerations that should be addressed at each stage of the process.

- Business Success Criteria: 

- Ethical Framework Questions: 
  - How could your system negatively impact individuals? The greatest negative impact would occur for a false positive diagnosis since this could delay treatment and in a life threatening scenario. A false negative would also be negatively impactful but to a lessor degree.
  - Who is most vulnerable and why? The most vulnerable would be patients with a 'M' dianosis not detectable by the model.
  - How much error in predictions can your business accept for this use case? False positives need to be minimised as much as posible. Minimsing False negatives are second in priority.
  - Will you need to explain which input factors had the greatest influence on outputs? Yes. Being able to explain which features have the most influence on outcome is very desirable.
  - Do you need PII or can you provide group-level data? The analysis requires patient level data however any PII can be anonymised

## 2. Data Understanding

- Ethical Framework Questions: 
  - Have you de-identified your data and taken measures to reduce the probability of reidentification? The data is de-identified.
  - Will socially sensitive features like gender or ethnic background influence outputs? No demographic data is present.
  - Are seemingly harmless features like location hiding proxies for socially sensitive features? No demographic data is present. 

#### Get Data File

- The Dataset used is obtained from: https://www.kaggle.com/c/instacart-market-basket-analysis

#### Load and check data

```{r, message = FALSE}
# Run once to create orders_train.csv and/or orders_test.csv file
# orders = read.csv("./input/orders.csv")
# orders_train <- subset(orders, eval_set=='train')
# write.csv(orders_train, "./input/orders_train.csv", row.names = F)

#orders_test <- subset(orders, eval_set=='test')
#write.csv(orders_test, "./input/orders_test.csv", row.names = F)
```

```{r, message = FALSE}
# Load data 
# full_file_name <- paste("./input/market_basket_data.csv",sep="")
# aisles = read.csv("./input/aisles.csv")
# departments = read.csv("./input/departments.csv")
order_products_train = read.csv("./input/order_products__train.csv")
# order_products__prior = read.csv("./input/order_products__prior.csv")
orders_train = read.csv("./input/orders_train.csv")
products = read.csv("./input/products.csv")
# sample_submission = read.csv("./input/sample_submission.csv")
```

```{r, message = FALSE}
# tmp <- order_products_train %>% 
#   left_join(products,by="product_id") %>% 
#   select(product_name, order_id, product_id, add_to_cart_order, reordered)  %>% 
  
#tmp <- merge(order_products_train, products, by.x="product_id", by.y="product_id")
tmp <- merge(order_products_train, orders_train, by.x="order_id", by.y="order_id")

#kable(tmp)
head(tmp, 12)
write.csv(tmp, "./input/orders_products_train_merged.csv", row.names = F)
#kable(head(tmp, 12))
```


```{r, message = FALSE}
# check data
# str(data_full)
# summary(data_full)

# kable(aisles)
# kable(departments)
# kable(head(order_products_train))
# kable(head(orders_train))
# kable(head(products))
# kable(head(sample_submission))
# names(order_products_train)
```

- 

## 3. Data Preparation

#### a) Data Modification

#### Column Removals

```{r, message = FALSE}
# Remove Lines for the ID and Null X final Columns
# data_full <- data_full[2:32]
```

#### Scale Data Set 

```{r, message = FALSE}
# Encoding the target feature as factor
# data_full$diagnosis = factor(data_full$diagnosis, levels = c('B', 'M'), labels = c(0,1))

# Scaling the dataset for models that require it
# data_scaled <- data_full
# data_scaled[,2:31] <- scale(data_scaled[,2:31])
# str(data_scaled)
# names(data_full)
```

#### b) Feature Engineering


#### View Correlation Matrix to explore highly correlated features

```{r, message = FALSE}

```

#### Check Feature variables distribution vs Target

```{r, message = FALSE}

```


#### 


```{r, message = FALSE}

```

- 

## 4. Data Modeling

- Ethical Framework Questions: 
  - Does your use case require a more interpretable algorithm? Accuracy is more impotant than interpretability for this study.
  - Should you be optimizing for a different outcome than accuracy to make your outcomes fairer? Since there is no demographic data, fairness would be hard to determine.
  - Is it possible that a malicious actor has compromised training data and created misleading results? No. The data is from a reputable source.

## 4. A) Data Modeling - 

```{r, message = FALSE}

```

## 5. A) Data Evaluation 

#### Test the Model

```{r, message = FALSE}

```


## 6. Final Model Analysis and Selection

#### Cost Analysis


```{r, message = FALSE}

```

#### Model Comparison

- The following Machine Learning Algorithms were used in this analysis:


```{r, message = FALSE}

```

#### Selected Model: 

## 7. Deployment

#### Shiny App Url: 

#### Summary Explanation

- Limitations of our analysis: 
  - 
  - 
  
- Further steps we could take: 
  - 
  - 
  
- Explanation of Model:
  - 
  - The Factors that contributed to malignant vs benign tumor identification were the following columns: 

- Ethical Framework Questions: 
  - Can a malicious actor infer information about individuals from your system? No. There is no PII present.
  - Are you able to identify anomalous activity on your system that might indicate a security breach? This would need to be considered for each specific deployment.
  - Do you have a plan to monitor for poor performance on individuals or subgroups? N/A since No demographic data is present.
  - Do you have a plan to log and store historical predictions if a consumer requests access in the future? N/A since No demographic data is present.
  - Have you documented model retraining cycles and can you confirm that a subjectâ€™s data has been removed from models? N/A since No demographic data is present.

## References

Yihui Xie, J. J. Allaire, Garrett Grolemund, 2019, R Markdown: The Definitive Guide
https://bookdown.org/yihui/rmarkdown/markdown-syntax.html

Jonathan McPherson, 2016, R Notebooks
https://blog.rstudio.com/2016/10/05/r-notebooks

Adam Kardash, Patricia Kosseim, 2018, Responsible AI in Consumer Enterprise, integrate.ai

